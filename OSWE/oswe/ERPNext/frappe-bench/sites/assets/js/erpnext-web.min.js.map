{"version":3,"file":"erpnext-web.min.js","sources":["../../../apps/erpnext/erpnext/public/js/website_utils.js","../../../apps/erpnext/erpnext/public/js/shopping_cart.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nif(!window.erpnext) window.erpnext = {};\n\n// Add / update a new Lead / Communication\n// subject, sender, description\nfrappe.send_message = function(opts, btn) {\n\treturn frappe.call({\n\t\ttype: \"POST\",\n\t\tmethod: \"erpnext.templates.utils.send_message\",\n\t\tbtn: btn,\n\t\targs: opts,\n\t\tcallback: opts.callback\n\t});\n};\n\nerpnext.subscribe_to_newsletter = function(opts, btn) {\n\treturn frappe.call({\n\t\ttype: \"POST\",\n\t\tmethod: \"frappe.email.doctype.newsletter.newsletter.subscribe\",\n\t\tbtn: btn,\n\t\targs: {\"email\": opts.email},\n\t\tcallback: opts.callback\n\t});\n}\n\n// for backward compatibility\nerpnext.send_message = frappe.send_message;\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n// shopping cart\nfrappe.provide(\"erpnext.shopping_cart\");\nvar shopping_cart = erpnext.shopping_cart;\n\nfrappe.ready(function() {\n\tvar full_name = frappe.session && frappe.session.user_fullname;\n\t// update user\n\tif(full_name) {\n\t\t$('.navbar li[data-label=\"User\"] a')\n\t\t\t.html('<i class=\"fa fa-fixed-width fa fa-user\"></i> ' + full_name);\n\t}\n\n\t// update login\n\tshopping_cart.show_shoppingcart_dropdown();\n\tshopping_cart.set_cart_count();\n\tshopping_cart.bind_dropdown_cart_buttons();\n});\n\n$.extend(shopping_cart, {\n\tshow_shoppingcart_dropdown: function() {\n\t\t$(\".shopping-cart\").on('shown.bs.dropdown', function() {\n\t\t\tif (!$('.shopping-cart-menu .cart-container').length) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: 'erpnext.shopping_cart.cart.get_shopping_cart_menu',\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t$('.shopping-cart-menu').html(r.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tupdate_cart: function(opts) {\n\t\tif(frappe.session.user===\"Guest\") {\n\t\t\tif(localStorage) {\n\t\t\t\tlocalStorage.setItem(\"last_visited\", window.location.pathname);\n\t\t\t}\n\t\t\twindow.location.href = \"/login\";\n\t\t} else {\n\t\t\treturn frappe.call({\n\t\t\t\ttype: \"POST\",\n\t\t\t\tmethod: \"erpnext.shopping_cart.cart.update_cart\",\n\t\t\t\targs: {\n\t\t\t\t\titem_code: opts.item_code,\n\t\t\t\t\tqty: opts.qty,\n\t\t\t\t\tadditional_notes: opts.additional_notes !== undefined ? opts.additional_notes : undefined,\n\t\t\t\t\twith_items: opts.with_items || 0\n\t\t\t\t},\n\t\t\t\tbtn: opts.btn,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tshopping_cart.set_cart_count();\n\t\t\t\t\tif (r.message.shopping_cart_menu) {\n\t\t\t\t\t\t$('.shopping-cart-menu').html(r.message.shopping_cart_menu);\n\t\t\t\t\t}\n\t\t\t\t\tif(opts.callback)\n\t\t\t\t\t\topts.callback(r);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tset_cart_count: function() {\n\t\tvar cart_count = frappe.get_cookie(\"cart_count\");\n\t\tif(frappe.session.user===\"Guest\") {\n\t\t\tcart_count = 0;\n\t\t}\n\n\t\tif(cart_count) {\n\t\t\t$(\".shopping-cart\").toggleClass('hidden', false);\n\t\t}\n\n\t\tvar $cart = $('.cart-icon');\n\t\tvar $badge = $cart.find(\"#cart-count\");\n\n\t\tif(parseInt(cart_count) === 0 || cart_count === undefined) {\n\t\t\t$cart.css(\"display\", \"none\");\n\t\t\t$(\".cart-items\").html('Cart is Empty');\n\t\t\t$(\".cart-tax-items\").hide();\n\t\t\t$(\".btn-place-order\").hide();\n\t\t\t$(\".cart-addresses\").hide();\n\t\t}\n\t\telse {\n\t\t\t$cart.css(\"display\", \"inline\");\n\t\t}\n\n\t\tif(cart_count) {\n\t\t\t$badge.html(cart_count);\n\t\t} else {\n\t\t\t$badge.remove();\n\t\t}\n\t},\n\n\tshopping_cart_update: function({item_code, qty, cart_dropdown, additional_notes}) {\n\t\tfrappe.freeze();\n\t\tshopping_cart.update_cart({\n\t\t\titem_code,\n\t\t\tqty,\n\t\t\tadditional_notes,\n\t\t\twith_items: 1,\n\t\t\tbtn: this,\n\t\t\tcallback: function(r) {\n\t\t\t\tfrappe.unfreeze();\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\t$(\".cart-items\").html(r.message.items);\n\t\t\t\t\t$(\".cart-tax-items\").html(r.message.taxes);\n\t\t\t\t\tif (cart_dropdown != true) {\n\t\t\t\t\t\t$(\".cart-icon\").hide();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t},\n\n\n\tbind_dropdown_cart_buttons: function () {\n\t\t$(\".cart-icon\").on('click', '.number-spinner button', function () {\n\t\t\tvar btn = $(this),\n\t\t\t\tinput = btn.closest('.number-spinner').find('input'),\n\t\t\t\toldValue = input.val().trim(),\n\t\t\t\tnewVal = 0;\n\n\t\t\tif (btn.attr('data-dir') == 'up') {\n\t\t\t\tnewVal = parseInt(oldValue) + 1;\n\t\t\t} else {\n\t\t\t\tif (oldValue > 1) {\n\t\t\t\t\tnewVal = parseInt(oldValue) - 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tinput.val(newVal);\n\t\t\tvar item_code = input.attr(\"data-item-code\");\n\t\t\tshopping_cart.shopping_cart_update({item_code, qty: newVal, cart_dropdown: true});\n\t\t\treturn false;\n\t\t});\n\n\t},\n\n});\n"],"names":[],"mappings":";;;CAAA;;;CAGA,GAAG,CAAC,MAAM,CAAC,OAAO,IAAE,MAAM,CAAC,OAAO,GAAG,EAAE,GAAC;;;;CAIxC,MAAM,CAAC,YAAY,GAAG,SAAS,IAAI,EAAE,GAAG,EAAE;EACzC,OAAO,MAAM,CAAC,IAAI,CAAC;GAClB,IAAI,EAAE,MAAM;GACZ,MAAM,EAAE,sCAAsC;GAC9C,GAAG,EAAE,GAAG;GACR,IAAI,EAAE,IAAI;GACV,QAAQ,EAAE,IAAI,CAAC,QAAQ;GACvB,CAAC,CAAC;EACH,CAAC;;CAEF,OAAO,CAAC,uBAAuB,GAAG,SAAS,IAAI,EAAE,GAAG,EAAE;EACrD,OAAO,MAAM,CAAC,IAAI,CAAC;GAClB,IAAI,EAAE,MAAM;GACZ,MAAM,EAAE,sDAAsD;GAC9D,GAAG,EAAE,GAAG;GACR,IAAI,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC;GAC3B,QAAQ,EAAE,IAAI,CAAC,QAAQ;GACvB,CAAC,CAAC;GACH;;;CAGD,OAAO,CAAC,YAAY,GAAG,MAAM,CAAC,YAAY,CAAC;;CC5B3C;;;;CAIA,MAAM,CAAC,OAAO,CAAC,uBAAuB,CAAC,CAAC;CACxC,IAAI,aAAa,GAAG,OAAO,CAAC,aAAa,CAAC;;CAE1C,MAAM,CAAC,KAAK,CAAC,WAAW;EACvB,IAAI,SAAS,GAAG,MAAM,CAAC,OAAO,IAAI,MAAM,CAAC,OAAO,CAAC,aAAa,CAAC;;EAE/D,GAAG,SAAS,EAAE;GACb,CAAC,CAAC,iCAAiC,CAAC;KAClC,IAAI,CAAC,+CAA+C,GAAG,SAAS,CAAC,CAAC;GACpE;;;EAGD,aAAa,CAAC,0BAA0B,EAAE,CAAC;EAC3C,aAAa,CAAC,cAAc,EAAE,CAAC;EAC/B,aAAa,CAAC,0BAA0B,EAAE,CAAC;EAC3C,CAAC,CAAC;;CAEH,CAAC,CAAC,MAAM,CAAC,aAAa,EAAE;EACvB,0BAA0B,EAAE,WAAW;GACtC,CAAC,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,mBAAmB,EAAE,WAAW;IACtD,IAAI,CAAC,CAAC,CAAC,qCAAqC,CAAC,CAAC,MAAM,EAAE;KACrD,OAAO,MAAM,CAAC,IAAI,CAAC;MAClB,MAAM,EAAE,mDAAmD;MAC3D,QAAQ,EAAE,SAAS,CAAC,EAAE;OACrB,IAAI,CAAC,CAAC,OAAO,EAAE;QACd,CAAC,CAAC,qBAAqB,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;QACzC;OACD;MACD,CAAC,CAAC;KACH;IACD,CAAC,CAAC;GACH;;EAED,WAAW,EAAE,SAAS,IAAI,EAAE;GAC3B,GAAG,MAAM,CAAC,OAAO,CAAC,IAAI,GAAG,OAAO,EAAE;IACjC,GAAG,YAAY,EAAE;KAChB,YAAY,CAAC,OAAO,CAAC,cAAc,EAAE,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;KAC/D;IACD,MAAM,CAAC,QAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC;IAChC,MAAM;IACN,OAAO,MAAM,CAAC,IAAI,CAAC;KAClB,IAAI,EAAE,MAAM;KACZ,MAAM,EAAE,wCAAwC;KAChD,IAAI,EAAE;MACL,SAAS,EAAE,IAAI,CAAC,SAAS;MACzB,GAAG,EAAE,IAAI,CAAC,GAAG;MACb,gBAAgB,EAAE,IAAI,CAAC,gBAAgB,KAAK,SAAS,GAAG,IAAI,CAAC,gBAAgB,GAAG,SAAS;MACzF,UAAU,EAAE,IAAI,CAAC,UAAU,IAAI,CAAC;MAChC;KACD,GAAG,EAAE,IAAI,CAAC,GAAG;KACb,QAAQ,EAAE,SAAS,CAAC,EAAE;MACrB,aAAa,CAAC,cAAc,EAAE,CAAC;MAC/B,IAAI,CAAC,CAAC,OAAO,CAAC,kBAAkB,EAAE;OACjC,CAAC,CAAC,qBAAqB,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC;OAC5D;MACD,GAAG,IAAI,CAAC,QAAQ;SACf,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAC;MAClB;KACD,CAAC,CAAC;IACH;GACD;;EAED,cAAc,EAAE,WAAW;GAC1B,IAAI,UAAU,GAAG,MAAM,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;GACjD,GAAG,MAAM,CAAC,OAAO,CAAC,IAAI,GAAG,OAAO,EAAE;IACjC,UAAU,GAAG,CAAC,CAAC;IACf;;GAED,GAAG,UAAU,EAAE;IACd,CAAC,CAAC,gBAAgB,CAAC,CAAC,WAAW,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;IACjD;;GAED,IAAI,KAAK,GAAG,CAAC,CAAC,YAAY,CAAC,CAAC;GAC5B,IAAI,MAAM,GAAG,KAAK,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;;GAEvC,GAAG,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,UAAU,KAAK,SAAS,EAAE;IAC1D,KAAK,CAAC,GAAG,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;IAC7B,CAAC,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;IACvC,CAAC,CAAC,iBAAiB,CAAC,CAAC,IAAI,EAAE,CAAC;IAC5B,CAAC,CAAC,kBAAkB,CAAC,CAAC,IAAI,EAAE,CAAC;IAC7B,CAAC,CAAC,iBAAiB,CAAC,CAAC,IAAI,EAAE,CAAC;IAC5B;QACI;IACJ,KAAK,CAAC,GAAG,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;IAC/B;;GAED,GAAG,UAAU,EAAE;IACd,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IACxB,MAAM;IACN,MAAM,CAAC,MAAM,EAAE,CAAC;IAChB;GACD;;EAED,oBAAoB,EAAE,SAAS,GAAiD,EAAE;iCAAvC;qBAAK;yCAAe;;;GAC9D,MAAM,CAAC,MAAM,EAAE,CAAC;GAChB,aAAa,CAAC,WAAW,CAAC;eACzB,SAAS;SACT,GAAG;sBACH,gBAAgB;IAChB,UAAU,EAAE,CAAC;IACb,GAAG,EAAE,IAAI;IACT,QAAQ,EAAE,SAAS,CAAC,EAAE;KACrB,MAAM,CAAC,QAAQ,EAAE,CAAC;KAClB,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE;MACV,CAAC,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;MACvC,CAAC,CAAC,iBAAiB,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;MAC3C,IAAI,aAAa,IAAI,IAAI,EAAE;OAC1B,CAAC,CAAC,YAAY,CAAC,CAAC,IAAI,EAAE,CAAC;OACvB;MACD;KACD;IACD,CAAC,CAAC;GACH;;;EAGD,0BAA0B,EAAE,YAAY;GACvC,CAAC,CAAC,YAAY,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,wBAAwB,EAAE,YAAY;IACjE,IAAI,GAAG,GAAG,CAAC,CAAC,IAAI,CAAC;KAChB,KAAK,GAAG,GAAG,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC;KACpD,QAAQ,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,IAAI,EAAE;KAC7B,MAAM,GAAG,CAAC,CAAC;;IAEZ,IAAI,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,IAAI,EAAE;KACjC,MAAM,GAAG,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;KAChC,MAAM;KACN,IAAI,QAAQ,GAAG,CAAC,EAAE;MACjB,MAAM,GAAG,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;MAChC;KACD;IACD,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;IAClB,IAAI,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;IAC7C,aAAa,CAAC,oBAAoB,CAAC,YAAC,SAAS,EAAE,GAAG,EAAE,MAAM,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC,CAAC;IAClF,OAAO,KAAK,CAAC;IACb,CAAC,CAAC;;GAEH;;EAED,CAAC,CAAC;;;;"}