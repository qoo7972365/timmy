<?php
  if (!isset($_GET["order"])) {
    header("Location: /?order=id");
    die();
  }
  require "header.php";

class User{
  public $id, $name, $age;
  function __construct($id, $name, $age){
    $this->name= $name;
    $this->age = $age;
    $this->id = $id;
  }
}

    $lnk = mysql_connect("localhost", "pentesterlab", "pentesterlab");
    $db = mysql_select_db('exercise', $lnk);

  $sql = "SELECT * FROM users ";

  $order = $_GET["order"];
  $result = mysql_query($sql);
  if ($result) {
    while ($row = mysql_fetch_assoc($result)) {
      $users[] = new User($row['id'],$row['name'],$row['age']);
    }
    if (isset($order)) {
      usort($users, create_function('$a, $b', 'return strcmp($a->'.$order.',$b->'.$order.');'));
    }
  }
?>

<div class="row">
  <div class="col-lg-12">
    <h1>Code execution 02</h1>

    <table class='table table-striped' >
    <tr>
      <th><a href="/?order=id">id</th>
      <th><a href="/?order=name">name</th>
      <th><a href="/?order=age">age</th>
    </tr>
    <?php

    foreach ($users as $user) {
      echo "<tr>";
          echo "<td>".$user->id."</td>";
          echo "<td>".$user->name."</td>";
          echo "<td>".$user->age."</td>";
      echo "</tr>";
    }
    echo "</table>";
  ?>
  <p>The objective of this exercise is to exploit the code execution in this page. </p>
  </div>
</div>



<?php


  require "footer.php";
?>

